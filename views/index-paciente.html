<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>WebDoctors</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Vendor CSS Files -->
  <link href="/menu/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/menu/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="/menu/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Medilab
  * Template URL: https://bootstrapmade.com/medilab-free-medical-bootstrap-theme/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="index-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="social-links d-none d-md-flex align-items-center">
          <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
          <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
          <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
        </div>
      </div>
    </div><!-- fim da barra superior -->

    <div class="branding d-flex align-items-center">

      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index-paciente.html" class="logo d-flex align-items-center me-auto">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.png" alt=""> -->
          <h1 class="sitename">WebDoctors</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="#marcar" onclick="openModal()">Marcar Consulta</a></li>
            <li class="dropdown"><a class="cta-btn d-none d-sm-block" href="#"><span>Mais opções</span> <i
                  class="bi bi-chevron-down toggle-dropdown"></i></a>
              <ul>
                <li><a href="#exame">Enviar Exame</a></li>
                <li><a href="#prontuario">Visualizar Prontuário</a></li>
                <li><a href="#fila">Visualizar Fila de Atendimento</a></li>
                <!-- <li><a href="#visualizar" onclick="openVisualizarModal()">Visualizar Consultas</a></li> -->
                <li><a href="#" id="logoutBtn">Sair</a></li>
              </ul>
            </li>
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

      </div>

    </div>

  </header>

  <main class="main">

    <!-- Hero Section -->
    <section id="hero" class="hero section light-background">

      <img src="/menu/img/hero-bg.jpg" alt="" data-aos="fade-in">

      <div class="container position-relative">

        <div class="welcome position-relative" data-aos="fade-down" data-aos-delay="100">
          <h2>Bem-Vindo ao WebDoctors</h2>
          <p>Buscando um bom atendimento a distância</p>
        </div><!-- fim da parte de bem-vindo -->

        <div class="content row gy-4">
          <div class="col-lg-4 d-flex align-items-stretch">
            <div class="why-box" data-aos="zoom-out" data-aos-delay="200">
              <h3> O que é o WebDoctors? </h3>
              <p>
                WebDoctors é um site de telemedicina que visa propocionar uma melhor experiência no atendimento online,
                com consultas e outras características importantes nesse contexto. Buscando sempre uma experiência do
                usuário confortável e adequada.
              </p>
            </div>
          </div><!-- fim da explicação sobre o site -->

          <div class="col-lg-8 d-flex align-items-stretch">
            <div class="d-flex flex-column justify-content-center">
              <div class="row gy-4">
                <section id="consultas-marcadas">
                  <div class="container">
                    <div class="row" id="consultas-container">
                      <!-- As consultas serão inseridas aqui pelo JS -->
                    </div>
                    <div id="sem-consultas" class="d-none">
                      <p>Você não tem consultas marcadas.</p>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
        <!-- fim -->

      </div>
      </div>
      </div>
      </div><!-- fim do conteúdo principal-->

      </div>

    </section>

    <!-- FIM DA PÁGINA PRINCIPAL -->

    <!-- Modal: Marcar Consulta -->
    <div id="marcarConsultaModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>Marcar Consulta</h2>

        <!-- Nome do Paciente -->
        <label for="nomePaciente">Nome do Paciente:</label>
        <input type="text" id="nome-paciente" name="nomePaciente" disabled>

        <!-- Selecionar Especialidade -->
        <label for="especialidade">Especialidade:</label>
        <select id="especialidade" name="especialidade" onchange="especialidadeSelecionada(this.value)">
          <option value="" disabled selected>Selecione a especialidade</option>
          <!-- Especialidades serão carregadas dinamicamente -->
        </select>

        <!-- Selecionar Médico -->
        <label for="medico">Médico:</label>
        <select id="medico" name="medico" onchange="medicoSelecionado(this.value)">
          <option value="" disabled selected>Selecione um médico</option>
          <!-- Médicos serão carregados dinamicamente -->
        </select>

        <!-- Selecionar Horário -->
        <label for="horario">Horário:</label>
        <select id="horario" name="horario" disabled>
          <option value="" disabled selected>Selecione um horário</option>
          <!-- Horários serão carregados dinamicamente -->
        </select>

        <!-- Motivo da Consulta -->
        <label for="motivo">Motivo da Consulta:</label>
        <textarea id="motivo" name="motivo" placeholder="Descreva o motivo da consulta"></textarea>

        <!-- Botão Confirmar -->
        <div class="button-container">
          <button id="confirmar-consulta" onclick="marcarConsulta()">Confirmar Consulta</button>
        </div>
      </div>
    </div>
    <!-- Fim do Modal -->


    <!-- Vendor JS Files -->
    <script src="/menu/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- link do js principal -->
    <script src="/menu/js/main_paciente.js"></script>

    <!-- CONEXÃO COM O BANCO -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('marcarConsultaModal'); // Certifique-se de que o ID do form está correto

        form.addEventListener('submit', async (e) => {
          e.preventDefault(); // Impede o envio padrão do formulário

          // Captura os valores dos campos do formulário
          const nomePaciente = document.getElementById('paciente').value;
          const nomeMedico = document.getElementById('medico').value;
          const data = document.getElementById('data').value;
          const hora = document.getElementById('hora').value;
          const motivo = document.getElementById('motivo').value;

          try {
            // Faz a requisição POST para o servidor Express
            const response = await fetch('http://localhost:3000/marcar-consulta', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ nomePaciente, nomeMedico, data, hora, motivo, status: "Pendente" }) // Ajuste conforme necessário
            });

            // Processa a resposta do servidor
            if (response.ok) {
              alert('Consulta marcada com sucesso!');
              form.reset(); // Limpa o formulário após o envio
            } else {
              alert('Erro ao marcar consulta.');
            }
          } catch (error) {
            //console.error('Erro:', error);
            //alert('Erro ao se conectar com o servidor.');
          }
        });
      });
    </script>
  </main>
</body>

</html>